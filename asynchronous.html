<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>异步编程</title>
</head>
<body>
    <script>
        //异步编程
        //同步与异步
        //简单的同步与异步
        let x=2;
        x=x+8;

        let i=2;
        setTimeout(()=>{return i=i+9,console.log(i)},2000);

        function double(value) {
        setTimeout(() => setTimeout(console.log, 0, value * 2), 1000);
        }
        double(3);

        //异步返回值
        //给异步操作提供一个回调，这个回调中包含要使用异步返回值的代码
        function asyndouble(value,callback){
            setTimeout(()=>callback(value),3000);
        }
        asyndouble(3,(value)=>{console.log(`the value is ${value*2}`)},3000);

        //异步操作的成功失败处理
        function suc(value,success,failure){
            setTimeout(
                ()=>{
                    try{
                    if(typeof value !=='number'){
                        throw('must provide number type')
                    }
                    success(value*2);
                }catch(e)
                {
                    failure(e);
                }
                }
                ,1000)
        }
        let successcallback=function(value){
            console.log(`the success value is ${value*2}` )
        }
        let failurecallback=function(value){
            console.log(`the error is ${value}`)
        }
        suc(1,successcallback,failurecallback);// the success value is 2
        suc('a',successcallback,failurecallback);// the error is must provide number type

        const successcallbacks=(x)=>{
            double(x,(y)=>{console.log(`success ${y}`)})           
        }
        suc(1,successcallbacks,failurecallback);

        //期约
        let p=new Promise(()=>{});
        setTimeout(console.log,0,p);//Promise <pending>
        //把一个期约实例传给控制台时，表示当前是pending状态，
        //期约有三种状态，fulfiled,rejected状态，状态是不可逆的，而这两种状态则不可更改
        let p1=new Promise((resolve,reject)=>resolve());
        setTimeout(console.log,0,p1);//<fulfilled>
        let p2=new Promise((resolve,reject)=>reject());
        setTimeout(console.log,0,p2);//<rejected>

        new Promise(()=>{setTimeout(console.log,0,"first")});
        setTimeout(console.log,0,"second");
        
        let ps=new Promise((resolve,reject)=>setTimeout(reject,1000));
        setTimeout(console.log,0,ps);//此时不会报出错误，因为setTimeout推迟了切换状态，此时ps的状态还没有改变
        //只要resolve或者reject中一个被调用，则不会改变状态，
        let p3=new Promise((resolve,reject)=>{
            reject();
            resolve();
        })
        setTimeout(console.log,0,p3)



    </script>
</body>
</html>